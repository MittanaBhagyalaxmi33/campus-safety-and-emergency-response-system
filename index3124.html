<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Safety & Emergency Response System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        :root {
            --primary: #1a3a6e;
            --secondary: #f8f9fa;
            --accent: #e63946;
            --text-dark: #333;
            --text-light: #f8f9fa;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-dark);
            background-color: #f5f5f5;
        }
        
        .navbar-brand {
            font-weight: 700;
            color: var(--primary);
        }
        
        .hero-section {
            background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                        url('https://picsum.photos/seed/campus/1200/400.jpg');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 5rem 0;
        }
        
        .emergency-btn {
            background-color: var(--accent);
            border: none;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .emergency-btn:hover {
            background-color: #c1303c;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s;
            height: 100%;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .alert-banner {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .safety-tip {
            background-color: var(--secondary);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .map-container {
            height: 400px;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .footer {
            background-color: var(--primary);
            color: var(--text-light);
            padding: 3rem 0;
        }
        
        .footer a {
            color: #adb5bd;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .footer a:hover {
            color: white;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .emergency-notification {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
            max-width: 350px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-shield-check me-2"></i>
                Campus Safety
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#emergency">Emergency</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#safety-resources">Safety Resources</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#safety-tips">Safety Tips</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#contact">Contact</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    <div class="position-relative me-3">
                        <button class="btn btn-outline-secondary position-relative" id="notificationBtn">
                            <i class="bi bi-bell"></i>
                            <span class="notification-badge">3</span>
                        </button>
                    </div>
                    <button class="btn btn-outline-primary" id="loginBtn">Log In</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section text-center">
        <div class="container">
            <h1 class="display-4 fw-bold mb-4">Campus Safety & Emergency Response</h1>
            <p class="lead mb-5">Your safety is our top priority. Find resources, report concerns, and stay informed about campus safety measures.</p>
            <a href="#emergency" class="btn btn-lg emergency-btn px-4 py-2">
                <i class="bi bi-exclamation-triangle me-2"></i>
                Emergency Response
            </a>
        </div>
    </section>

    <!-- Emergency Response Section -->
    <section id="emergency" class="py-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <h2 class="fw-bold mb-4">Emergency Response</h2>
                    <p class="lead mb-4">In case of an emergency, quick action can make a difference. Use the resources below to respond effectively.</p>
                    
                    <!-- Dynamic Emergency Contacts will load here -->
<div id="emergency-contacts" class="d-grid gap-2 mb-4"><a href="tel:911" class="btn btn-lg emergency-btn text-white">
        <i class="bi bi-telephone-fill me-2"></i>
        Call 911
    </a>
    <a href="tel: 8074939204
    </a>" class="btn btn-lg btn-outline-primary">
        <i class="bi bi-shield-fill me-2"></i>
        Police: 8074939204
    </a>
    <a href="tel: 9494702706" class="btn btn-lg btn-outline-primary">
        <i class="bi bi-ambulance me-2"></i>
        Ambulance: 9494702706
    </a>
    <a href="tel:9949249689" class="btn btn-lg btn-outline-primary">
        <i class="bi bi-fire me-2"></i>
        Fire Department: 9949249689
    </a>
    <a href="tel:7013930211" class="btn btn-lg btn-outline-primary">
        <i class="bi bi-hospital me-2"></i>
        Emergency Services: 7013930211
    </a>
    </div>

<!-- Call All Contacts Button -->
<button onclick="triggerEmergencyCall()" class="btn btn-danger btn-lg mb-4">
  üìû Call All Emergency Contacts
</button>
<!-- WhatsApp Emergency Button -->
<a onclick="sendWhatsAppEmergency()" class="btn btn-success btn-lg text-white mb-4">
  <i class="bi bi-whatsapp me-2"></i> WhatsApp Emergency Alert
</a>
<button id="loadContactsBtn" class="btn btn-outline-secondary mb-3">
    Load Emergency Contacts
</button>
<button class="btn btn-warning btn-lg" onclick="shareLocationViaWhatsApp()">üìç Share Live Location</button>
<button onclick="startCrowdMonitor()" class="btn btn-danger mt-3">üé• Monitor Crowd</button>
<video id="camFeed" width="320" height="240" autoplay muted class="mt-3"></video>
<!-- Video Upload & Crowd Detection -->
<div class="card p-4 mb-4">
  <h4 class="fw-bold mb-3">üìπ Upload Video for Crowd Detection</h4>
  <input type="file" id="videoInput" accept="video/*" class="form-control mb-3">
  <button onclick="uploadVideo()" class="btn btn-primary">Upload & Analyze</button>
  <div id="uploadStatus" class="mt-3 fw-semibold text-danger"></div>
</div>



                    
                    <div class="alert alert-banner p-3 mb-0">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-info-circle-fill me-2 text-warning fs-4"></i>
                            <div>
                                <strong>Current Alert:</strong> There is no active emergency on campus at this time. Regular campus operations are ongoing.
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card border-0 shadow">
                        <div class="card-body p-4">
                            <h3 class="card-title fw-bold mb-4">Emergency Protocols</h3>
                            <div class="mb-3">
                                <h5><i class="bi bi-exclamation-octagon text-danger me-2"></i>Active Threat</h5>
                                <p>Run, Hide, Fight. Evacuate if possible, find a secure location if not, and as a last resort, be prepared to defend yourself.</p>
                            </div>
                            <div class="mb-3">
                                <h5><i class="bi bi-fire text-danger me-2"></i>Fire</h5>
                                <p>Alert others, evacuate immediately using the nearest exit, and call 911. Do not use elevators.</p>
                            </div>
                            <div class="mb-3">
                                <h5><i class="bi bi-cloud-haze2 text-primary me-2"></i>Severe Weather</h5>
                                <p>Seek shelter in a designated safe area, away from windows. Follow instructions from emergency personnel.</p>
                            </div>
                            <div>
                                <h5><i class="bi bi-droplet-half text-primary me-2"></i>Medical Emergency</h5>
                                <p>Call 911 and provide assistance if trained. Stay with the person until help arrives.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Safety Resources Section -->
    <section id="safety-resources" class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center fw-bold mb-5">Safety Resources</h2>
            <div class="row g-4">
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 p-4 text-center">
                        <div class="card-icon">
                            <i class="bi bi-geo-alt"></i>
                        </div>
                        <h4>Emergency Locations</h4>
                        <p>Find the nearest emergency phones, safe zones, and evacuation points on campus.</p>
                        <a href="#" class="btn btn-sm btn-outline-primary">View Map</a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 p-4 text-center">
                        <div class="card-icon">
                            <i class="bi bi-camera-video"></i>
                        </div>
                        <h4>Security Cameras</h4>
                        <p>Learn about our security camera network and how it contributes to campus safety.</p>
                        <a href="#" class="btn btn-sm btn-outline-primary">Learn More</a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 p-4 text-center">
                        <div class="card-icon">
                            <i class="bi bi-lightbulb"></i>
                        </div>
                        <h4>Safety Workshops</h4>
                        <p>Participate in our safety workshops to learn essential safety skills and preparedness.</p>
                        <a href="#" class="btn btn-sm btn-outline-primary">View Schedule</a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 p-4 text-center">
                        <div class="card-icon">
                            <i class="bi bi-person-badge"></i>
                        </div>
                        <h4>Campus Escort</h4>
                        <p>Request a safety escort if you need to travel across campus after dark.</p>
                        <a href="#" class="btn btn-sm btn-outline-primary">Request Escort</a>
                    </div>
                </div>
            </div>
            
            <div class="mt-5">
                <h3 class="fw-bold mb-4">Campus Safety Map</h3>
                <div class="map-container shadow-sm">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3022.9663095343008!2d-73.99619892422747!3d40.70592486943831!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x89c25a23e28c1191%3A0x49f75d3281df052a!2sBaruch%20College!5e0!3m2!1sen!2sus!4v1623456789012!5m2!1sen!2sus" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                </div>
            </div>
        </div>
    </section>

    <!-- Safety Tips Section -->
    <section id="safety-tips" class="py-5">
        <div class="container">
            <h2 class="text-center fw-bold mb-5">Safety Tips</h2>
            
            <div class="safety-tip">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h4><i class="bi bi-lock me-2 text-primary"></i>Personal Safety</h4>
                        <p>Always be aware of your surroundings. Avoid using headphones at high volumes when walking alone. Keep your phone charged and easily accessible in case of emergencies.</p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <button class="btn btn-sm btn-outline-secondary">Read More</button>
                    </div>
                </div>
            </div>
            
            <div class="safety-tip">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h4><i class="bi bi-building me-2 text-primary"></i>Building Safety</h4>
                        <p>Know the location of emergency exits in buildings you frequent. Check that doors are properly locked at night. Report any security concerns or maintenance issues to campus safety.</p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <button class="btn btn-sm btn-outline-secondary">Read More</button>
                    </div>
                </div>
            </div>
            
            <div class="safety-tip">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h4><i class="bi bi-phone me-2 text-primary"></i>Digital Safety</h4>
                        <p>Protect your personal information online. Use strong, unique passwords for all accounts. Be cautious when sharing location data or personal details on social media.</p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <button class="btn btn-sm btn-outline-secondary">Read More</button>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-5">
                <a href="#" class="btn btn-primary px-4 py-2">View All Safety Tips</a>
            </div>
        </div>
    </section>

    <!-- Report Concern Section -->
    <section class="py-5 bg-light">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8 text-center">
                    <h2 class="fw-bold mb-4">Report a Concern</h2>
                    <p class="lead mb-5">If you witness or experience any safety concern, please report it immediately using the form below.</p>
                    
                    <div class="card shadow-sm">
                        <div class="card-body p-4 p-md-5">
                            <form>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="name" class="form-label">Your Name</label>
                                        <input type="text" class="form-control" id="name" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="email" class="form-label">Email Address</label>
                                        <input type="email" class="form-control" id="email" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="phone" class="form-label">Phone Number</label>
                                        <input type="tel" class="form-control" id="phone">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="reportType" class="form-label">Report Type</label>
                                        <select class="form-select" id="reportType" required>
                                            <option value="" selected disabled>Select a category</option>
                                            <option value="safety">Safety Concern</option>
                                            <option value="security">Security Issue</option>
                                            <option value="harassment">Harassment</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                    <div class="col-12">
                                        <label for="location" class="form-label">Location</label>
                                        <input type="text" class="form-control" id="location" required>
                                    </div>
                                    <div class="col-12">
                                        <label for="description" class="form-label">Description</label>
                                        <textarea class="form-control" id="description" rows="4" required></textarea>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="anonymous">
                                            <label class="form-check-label" for="anonymous">
                                                Submit anonymously
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-12 mt-4">
                                        <button type="submit" class="btn btn-primary px-4 py-2">Submit Report</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Emergency Notification -->
    <div class="emergency-notification alert alert-danger shadow-lg" role="alert">
        <div class="d-flex align-items-center">
            <i class="bi bi-exclamation-triangle-fill me-2 fs-4"></i>
            <div>
                <strong>Emergency Alert:</strong> <span id="alertMessage">Active weather alert in your area. Seek shelter immediately.</span>
            </div>
            <button type="button" class="btn-close ms" id="closeAlert"></button>
        </div>
    </div>

    <!-- Footer -->
    <footer id="contact" class="footer">
        <div class="container">
            <div class="row gy-4">
                <div class="col-lg-4">
                    <h4 class="fw-bold mb-4">Campus Safety</h4>
                    <p>Providing a safe and secure environment for all members of our campus community.</p>
                    <div class="d-flex gap-3 mt-4">
                        <a href="#" class="text-white"><i class="bi bi-facebook fs-5"></i></a>
                        <a href="#" class="text-white"><i class="bi bi-twitter fs-5"></i></a>
                        <a href="#" class="text-white"><i class="bi bi-instagram fs-5"></i></a>
                        <a href="#" class="text-white"><i class="bi bi-youtube fs-5"></i></a>
                    </div>
                </div>
                <div class="col-md-4 col-lg-2">
                    <h5 class="fw-bold mb-4">Quick Links</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#">Home</a></li>
                        <li class="mb-2"><a href="#emergency">Emergency</a></li>
                        <li class="mb-2"><a href="#safety-resources">Safety Resources</a></li>
                        <li class="mb-2"><a href="#safety-tips">Safety Tips</a></li>
                        <li class="mb-2"><a href="#contact">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-4 col-lg-3">
                    <h5 class="fw-bold mb-4">Contact</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><i class="bi bi-geo-alt me-2"></i>123 University Ave, City, State</li>
                        <li class="mb-2"><i class="bi bi-telephone me-2"></i>555-123-4567</li>
                        <li class="mb-2"><i class="bi bi-envelope me-2"></i>safety@university.edu</li>
                        <li class="mb-2"><i class="bi bi-clock me-2"></i>24/7 Emergency Response</li>
                    </ul>
                </div>
                <div class="col-md-4 col-lg-3">
                    <h5 class="fw-bold mb-4">Emergency Contacts</h5>
                    <div class="d-grid gap-2">
                        <a href="tel:911" class="btn btn-outline-light">
                            <i class="bi bi-telephone-fill me-2"></i>
                            Call 911
                        </a>
                        <a href="tel:555-123-4567" class="btn btn-outline-light">
                            <i class="bi bi-shield-fill me-2"></i>
                            Campus Safety
                        </a>
                    </div>
                </div>
            </div>
            <hr class="mt-4 mb-3 border-secondary">
            <div class="text-center">
                <p class="mb-0">&copy; 2023 Campus Safety and Emergency Response System. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
async function loadEmergencyContacts() {
    try {
        const response = await fetch('https://2sxwjemtc8.execute-api.ap-south-1.amazonaws.com/dev/contacts');

        const contacts = await response.json();

        const container = document.querySelector('#emergency-contacts');

        contacts.forEach(contact => {
            const btn = document.createElement('a');
            btn.className = "btn btn-lg btn-outline-primary";
            btn.href = `tel:${contact.number}`;
            btn.innerHTML = `<i class="bi bi-telephone-fill me-2"></i> ${contact.name}: ${contact.number}`;
            container.appendChild(btn);
        });
    } catch (error) {
        console.error("Failed to load emergency contacts:", error);
    }
}

document.getElementById('loadContactsBtn').addEventListener('click', loadEmergencyContacts);
</script>
    <script>
        // Show emergency notification after page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                document.querySelector('.emergency-notification').style.display = 'block';
            }, 3000);
            
            // Close alert button
            document.getElementById('closeAlert').addEventListener('click', function() {
                document.querySelector('.emergency-notification').style.display = 'none';
            });
            
            // Notification button
            document.getElementById('notificationBtn').addEventListener('click', function() {
                alert('You have 3 unread safety notifications');
            });
            
            // Login button
            document.getElementById('loginBtn').addEventListener('click', function() {
                // This would typically open a modal or redirect to login page
                alert('Login functionality would be implemented here');
            });
            
            // Form submission
            const form = document.querySelector('form');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Create a toast notification
                const toastContainer = document.createElement('div');
                toastContainer.style.position = 'fixed';
                toastContainer.style.bottom = '20px';
                toastContainer.style.left = '20px';
                toastContainer.style.zIndex = '1050';
                
                const toast = document.createElement('div');
                toast.className = 'toast show';
                toast.setAttribute('role', 'alert');
                toast.setAttribute('aria-live', 'assertive');
                toast.setAttribute('aria-atomic', 'true');
                
                toast.innerHTML = `
                    <div class="toast-header">
                        <strong class="me-auto">Report Submitted</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        Thank you for your report. Our team will review it shortly.
                    </div>
                `;
                
                toastContainer.appendChild(toast);
                document.body.appendChild(toastContainer);
                
                // Clear form
                form.reset();
                
                // Remove toast after 5 seconds
                setTimeout(() => {
                    toastContainer.remove();
                }, 5000);
            });
        });
    </script>

<script>
  async function triggerEmergencyCall() {
    try {
      const response = await fetch(`https://2sxwjemtc8.execute-api.ap-south-1.amazonaws.com/dev/call`, {
        method: 'POST'
      });
      const result = await response.json();
      alert(result.message);
    } catch (error) {
      alert("Call failed: " + error.message);
    }
  }
</script>
<script>
async function sendWhatsAppEmergency() {
  try {
    // 1. Get user's current location
    if (!navigator.geolocation) {
      alert("Geolocation is not supported by your browser");
      return;
    }

    navigator.geolocation.getCurrentPosition(async (position) => {
      const latitude = position.coords.latitude;
      const longitude = position.coords.longitude;
      const locationLink = `https://www.google.com/maps?q=${latitude},${longitude}`;

      // 2. Compose emergency message
      const message = encodeURIComponent(`üö® Emergency Alert!\nImmediate help needed!\nüìç Location: ${locationLink}`);

      // 3. Fetch contact numbers from the backend
      const response = await fetch(`https://2sxwjemtc8.execute-api.ap-south-1.amazonaws.com/dev/contacts`);
      const contacts = await response.json();

      // 4. Open WhatsApp for each contact
      contacts.forEach(contact => {
        const whatsappURL = `https://wa.me/${contact.number.replace(/\D/g, '')}?text=${message}`;
        window.open(whatsappURL, '_blank');
      });

    }, () => {
      alert("Unable to retrieve location.");
    });

  } catch (error) {
    alert("WhatsApp emergency failed: " + error.message);
  }
}
</script><script>
async function sendWhatsAppEmergency() {
  try {
    // 1. Get user's current location
    if (!navigator.geolocation) {
      alert("Geolocation is not supported by your browser");
      return;
    }

    navigator.geolocation.getCurrentPosition(async (position) => {
      const latitude = position.coords.latitude;
      const longitude = position.coords.longitude;
      const locationLink = `https://www.google.com/maps?q=${latitude},${longitude}`;

      // 2. Compose emergency message
      const message = encodeURIComponent(`üö® Emergency Alert!\nImmediate help needed!\nüìç Location: ${locationLink}`);

      // 3. Fetch contact numbers from the backend
      const response = await fetch(`https://2sxwjemtc8.execute-api.ap-south-1.amazonaws.com/dev/contacts`);
      const contacts = await response.json();

      // 4. Open WhatsApp for each contact
      contacts.forEach(contact => {
        const whatsappURL = `https://wa.me/${contact.number.replace(/\D/g, '')}?text=${message}`;
        window.open(whatsappURL, '_blank');
      });

    }, () => {
      alert("Unable to retrieve location.");
    });

  } catch (error) {
    alert("WhatsApp emergency failed: " + error.message);
  }
}
</script>

<script>
async function uploadVideo() {
    const input = document.getElementById("videoInput");
    const status = document.getElementById("uploadStatus");

    const file = input.files[0];
    if (!file) {
        status.innerText = "‚ùå Please select a video.";
        return;
    }

    const formData = new FormData();
    formData.append("video", file);

    status.innerText = "‚è≥ Uploading and analyzing...";

    try {
        const response = await fetch("http://127.0.0.1:5000/upload-video", {
            method: "POST",
            body: formData
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Server responded with status ${response.status}: ${errorText}`);
        }

        const data = await response.json();

        if (data.crowd_detected) {
            status.innerText = "üë• Crowd detected! Sending WhatsApp...";
            sendWhatsAppEmergency();
        } else {
            status.innerText = "‚úÖ No crowd detected.";
        }
    } 
}
</script>

<script>
async function startCrowdMonitor() {
  const video = document.getElementById('camFeed');
  if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
    alert("Camera not supported.");
    return;
  }

  const stream = await navigator.mediaDevices.getUserMedia({ video: true });
  video.srcObject = stream;

  // ‚ö† Simulated crowd detection after 10 seconds
  setTimeout(() => {
    triggerEmergencyFromCrowd();
  }, 10000);
}

function triggerEmergencyFromCrowd() {
  alert("üö® Crowd detected! Sending emergency alert...");

  navigator.geolocation.getCurrentPosition((pos) => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const message =`üö® Crowd detected! Location: https://www.google.com/maps?q=${lat},${lon}`;
    const phone = "918074939204"; // WhatsApp admin or police
    window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, '_blank');
  });
}
</script>
<script>
function shareLocationViaWhatsApp() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;
      const message = 'üìç Emergency! My location: https://www.google.com/maps?q=${lat},${lon}';
      const phone = "919949249689"; // Replace with your WhatsApp number
      window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, '_blank');
    }, function() {
      alert("Unable to access location.");
    });
  } else {
    alert("Geolocation is not supported.");
  }
}
</script>
<script>
async function uploadVideo() {
    const input = document.getElementById("videoInput");
    const status = document.getElementById("uploadStatus");

    const file = input.files[0];
    if (!file) {
        status.innerText = "‚ùå Please select a video.";
        return;
    }

    const formData = new FormData();
    formData.append("video", file);

    status.innerText = "‚è≥ Uploading and analyzing...";

    try {
        const response = await fetch("http://localhost:5000/upload-video", {
            method: "POST",
            body: formData
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Server error: ${response.status} - ${errorText}`);
        }

        const data = await response.json();
        if (data.crowd_detected) {
            status.innerText = "üë• Crowd detected! Sending WhatsApp...";
            sendWhatsAppEmergency();
        } else {
            status.innerText = "‚úÖ No crowd detected.";
        }
    } catch (err) {
        console.error("Upload failed:", err);
        status.innerText = "‚ùå Upload failed: " + err.message;
    }
}
</script>



</body>
</html>